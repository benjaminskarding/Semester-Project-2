import{c as f}from"./conditionallyDisplay-Cby9GP4M.js";import{u as g,a as m,b as y,d as P}from"./displayCredits-DmSZQ3LS.js";import"./headers-Dr2M59D8.js";function E(r){return/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|bmp|webp))$/i.test(r)}function h(r){if(!r){console.error("No data to render profile.");return}const e=document.getElementById("username"),t=document.getElementById("profilePicture");e?e.textContent=r.name||"Unknown User":console.error("#username element not found."),t?(t.src=r.avatar?.url||"",t.alt=r.avatar?.alt||"Profile Picture"):console.error("#profilePicture element not found.")}function U(r){const e=document.getElementById("updateButton"),t=document.getElementById("imageUrlInput");if(!e||!t){console.error("Update button or image URL input not found.");return}e.addEventListener("click",async()=>{const n=t.value.trim();if(!n||!E(n)){alert("Please enter a valid image URL (e.g., a public URL ending in .jpg, .png).");return}try{if(await w(r,n)){alert("Profile picture updated successfully!");const i=document.getElementById("profilePicture");i&&(i.src=n)}else alert("Failed to update profile picture.")}catch(o){console.error("Error updating profile picture:",o),alert("Failed to update profile picture. Please try again.")}})}async function I(){const r=localStorage.getItem("username");if(!r){console.error("User is not logged in.");return}try{const e=await m(r),t=document.getElementById("listings-container"),n=document.getElementById("user-listings");if(!t||!n){console.error("Listings container or user listings container not found!");return}if(t.innerHTML="",e.length===0){t.className="",t.innerHTML='<p class="text-gray-500 text-center">You have no active listings.</p>';return}e.forEach(o=>{const{id:i,title:s,description:l,media:a,endsAt:c}=o,d=a.length>0?a[0].url:"/images/placeholderimage2.jfif",u=new Date(c).toLocaleDateString(),p=`
        <div class="border border-gray-700 rounded p-4">
          <a href="/listing/?id=${i}" class="block">
            <img src="${d}" alt="${s}" class="w-full h-40 object-cover rounded mb-4">
          </a>
          <h3 class="font-bold text-lg mb-2">${s}</h3>
          <p class="text-sm text-gray-400 mb-2">${l||"No description provided."}</p>
          <p class="text-sm text-yellow-400">Ends on: ${u}</p>
        </div>
      `;t.insertAdjacentHTML("beforeend",p)})}catch(e){console.error("Error rendering user listings:",e)}}async function w(r,e){try{const t=await g(r,{avatar:{url:e}});if(!t)throw new Error("Invalid API response. Failed to update profile picture.");return t}catch(t){throw console.error("Error updating profile picture:",t),t}}async function b(){const r=localStorage.getItem("username");if(!r){console.error("No username found in localStorage.");return}try{const e=await y(r);e?h(e):console.error("Failed to load profile data."),P("totalCredits"),U(r)}catch(e){console.error("Error in profileView:",e)}}f();b();I();export{b as default};
